# Исправления отображения таблиц - 20 декабря 2025

## Проблемы (из скриншота)

1. ❌ Не отображается колонка "№" (номер строки)
2. ❌ Обрезаются числа в УКТ ЗЕД (8501510090)
3. ❌ Обрезаются цены (4341.66, 4791.66)
4. ❌ Обрезаются суммы (8683.32, 9583.32)
5. ❌ Колонка "Товар" занимает слишком много места

## Решения (без хардкода)

### 1. Исправлено определение колонки номера строки

**Проблема:** Значения "1.0", "2.0" имеют `maxLength=3` и не попадали под условие `maxLength <= 3`

**Решение:**
```javascript
const isLineNumber = analysis.numericRatio === 1.0 &&
                    analysis.uniqueRatio === 1.0 &&
                    analysis.maxLength <= 5 &&  // Было: <= 3
                    analysis.avgLength <= 4;    // Добавлено
```

**Результат:** Колонка "№" теперь определяется как line-number даже с десятичными значениями

---

### 2. Исправлено отображение числовых колонок

**Проблема:** Input с padding обрезал длинные числа

**Решение CSS:**
```css
.editable-items-table th.col-numeric,
.editable-items-table td.col-numeric {
    min-width: max-content; /* Вместо width: 1% */
}

.editable-items-table td.col-numeric input {
    padding: 8px 6px; /* Уменьшен padding с 10px */
    min-width: 100%;
}
```

**Результат:** Все цифры теперь видны полностью

---

### 3. Исправлено отображение кодов (УКТ ЗЕД)

**Проблема:** Длинные коды обрезались

**Решение CSS:**
```css
.editable-items-table td.col-code {
    min-width: max-content;
    white-space: nowrap !important;
}

.editable-items-table td.col-code input {
    padding: 8px 6px;
    min-width: 100%;
}
```

**Результат:** Коды отображаются полностью

---

### 4. Оптимизирована колонка товара

**Проблема:** Колонка слишком широкая, занимает много места

**Решение JS:**
```javascript
// Всегда использовать textarea для текста длиннее 30 символов
const needsWrap = analysis.avgLength > 30 ||
                 analysis.avgLength > lengthMidpoint ||
                 analysis.avgWords > wordsThreshold;

// Ограничена ширина текстовых колонок
minWidthCh = Math.max(25, Math.min(45, ...)); // Было: 20-60
```

**Решение CSS:**
```css
.editable-items-table th.col-text,
.editable-items-table td.col-text {
    max-width: 45ch !important; /* Ограничение ширины */
}

.editable-items-table td.col-text textarea {
    min-height: 38px; /* Компактная высота */
    max-height: 120px; /* Ограничение высоты */
    padding: 6px 8px; /* Компактный padding */
}
```

**Результат:**
- Товар отображается в textarea (видны все символы)
- Колонка занимает меньше места
- Текст переносится на несколько строк

---

## Ключевые принципы (без хардкода)

✅ **Все правила динамические** - основаны на анализе контента
✅ **Нет фиксированных ширин** - используются `max-content`, `min-width`, `max-width`
✅ **Адаптивные пороги** - из `state.config.columnAnalysis`
✅ **Универсальная логика** - работает для любого документа

---

## Измененные файлы

1. **`static/script.js`**:
   - Улучшено определение line-number колонки
   - Текстовые колонки используют textarea при avgLength > 30
   - Ограничена max ширина текстовых колонок (25-45ch)

2. **`static/style.css`**:
   - Числовые и кодовые колонки: `min-width: max-content`
   - Уменьшен padding для input в числовых/кодовых колонках
   - Добавлено ограничение `max-width: 45ch` для текстовых колонок
   - Оптимизированы стили textarea в текстовых колонках

---

## Тестирование

1. Перезагрузите страницу (Ctrl+Shift+R - hard reload)
2. Откройте DevTools → Console
3. Загрузите документ
4. Проверьте:
   - ✅ Колонка "№" отображается
   - ✅ Все цифры в УКТ ЗЕД видны
   - ✅ Все цифры в ценах видны
   - ✅ Все цифры в суммах видны
   - ✅ Товар в textarea, текст полностью виден
   - ✅ Таблица компактная, не слишком широкая

---

## Результат

**До:**
- Нет колонки №
- Обрезаны числа: 85015100... → 8501510
- Товар занимает слишком много места
- Input не показывает все символы

**После:**
- ✅ Колонка № отображается
- ✅ Все числа видны: 8501510090
- ✅ Товар в textarea с оптимальной шириной
- ✅ Все символы видны во всех колонках

