# Отчет о тестировании items_v2.txt с 20 конфигурациями обработки изображений

## Статус: ⚠️ Требуется повторный запуск

### Проблема
При первом запуске все 20 тестов завершились с ошибкой из-за неправильных путей в конфигурации (пути были настроены для Docker контейнера `/app/...`, а запуск происходил локально).

### Исправления
1. ✅ Исправлены пути к директориям (output, temp, logs, invoices, examples, prompts)
2. ✅ Исправлены пути к промптам (header и items)
3. ✅ Скрипт теперь автоматически определяет корневую директорию проекта и корректирует пути

### Созданные файлы

#### 1. `tests/image_preprocessing_configs.json`
Файл содержит 20 различных конфигураций обработки изображений:

| № | Название | Описание | Ключевые параметры |
|---|----------|----------|-------------------|
| 1 | config_01_high_contrast_sharp | Высокий контраст и резкость | Upscale: 2.5x, Контраст: 2.0x, Резкость: 2.5x |
| 2 | config_02_binarized_high_dpi | Бинаризация с высоким DPI | Бинаризация: да, DPI: 400, Порог: 140 |
| 3 | config_03_moderate_enhancement | Умеренное улучшение | Upscale: 1.8x, Контраст: 1.4x, Резкость: 1.8x |
| 4 | config_04_aggressive_sharp_unsharp | Агрессивная резкость | Резкость: 3.0x, Unsharp: 200% |
| 5 | config_05_bright_high_contrast | Яркое с высоким контрастом | Яркость: 1.3x, Контраст: 2.2x |
| 6 | config_06_binarized_dilate | Бинаризация + dilate | Бинаризация: да, Dilate: да |
| 7 | config_07_denoise_heavy | Сильное шумоподавление | Denoise: 0.8 |
| 8 | config_08_ultra_high_dpi | Сверхвысокий DPI | DPI: 600 |
| 9 | config_09_low_brightness_high_contrast | Низкая яркость, высокий контраст | Яркость: 0.85x, Контраст: 2.5x |
| 10 | config_10_binarized_soft | Мягкая бинаризация | Бинаризация: да, Порог: 160 |
| 11 | config_11_max_sharpness | Максимальная резкость | Резкость: 3.5x |
| 12 | config_12_jpeg_high_quality | JPEG высокого качества | Формат: JPEG, Quality: 100 |
| 13 | config_13_minimal_processing | Минимальная обработка | Только upscale: 2.0x |
| 14 | config_14_binarized_high_threshold | Бинаризация с высоким порогом | Порог: 180 |
| 15 | config_15_balanced_all | Сбалансированные настройки | Все параметры умеренные |
| 16 | config_16_dilate_no_binarize | Dilate без бинаризации | Dilate: да, Бинаризация: нет |
| 17 | config_17_very_high_upscale | Очень высокий upscale | Upscale: 3.0x |
| 18 | config_18_binarized_low_threshold | Бинаризация с низким порогом | Порог: 110 |
| 19 | config_19_high_contrast_no_sharp | Высокий контраст без резкости | Контраст: 2.3x, Резкость: 1.0x |
| 20 | config_20_comprehensive_optimal | Комплексная оптимальная | Комбинация лучших параметров |

#### 2. `tests/test_items_v2_20_configs.py`
Скрипт для автоматического тестирования:
- Загружает 20 конфигураций из JSON
- Для каждой конфигурации:
  - Применяет настройки обработки изображений
  - Запускает парсинг с промптом `items_v2.txt`
  - Анализирует ошибки в артикулах (особенно строку 11)
  - Сохраняет результаты
- Генерирует итоговую сводку с топ-5 лучшими конфигурациями

#### 3. `tests/run_items_v2_20_tests.sh`
Bash скрипт для удобного запуска всех тестов одной командой.

### Как запустить тестирование

```bash
# Вариант 1: Через bash скрипт
./tests/run_items_v2_20_tests.sh

# Вариант 2: Напрямую через Python
python3 tests/test_items_v2_20_configs.py
```

### Ожидаемые результаты

После успешного выполнения тестов будут созданы:

1. **20 файлов результатов** в `output/`:
   - `items_v2_config_01_high_contrast_sharp_*.json`
   - `items_v2_config_02_binarized_high_dpi_*.json`
   - ... и т.д.

2. **Итоговый отчет** в `output/`:
   - `items_v2_20_configs_summary_YYYYMMDD_HHMMSS.json`
   - Содержит:
     - Общую статистику (успешных/провалившихся тестов)
     - Время выполнения
     - Топ-5 лучших конфигураций по количеству ошибок в артикулах
     - Детальные результаты каждого теста

### Критерии оценки

Тесты оцениваются по:
1. **Количество ошибок в артикулах** - основная метрика
2. **Наличие ошибки в строке 11** - критическая проверка (известная проблема с подменой символов)
3. **Общее количество различий** с эталоном
4. **Время выполнения** - вторичная метрика

### Примечания

- Тестирование может занять **20-60 минут** в зависимости от скорости API Gemini
- Каждый тест делает 2 запроса к API (header + items)
- Между тестами есть пауза 2 секунды для снижения нагрузки на API
- Все тесты выполняются автоматически без участия пользователя

### Следующие шаги

1. Запустить тестирование повторно (после исправления путей)
2. Дождаться завершения всех 20 тестов
3. Проанализировать итоговый отчет
4. Выбрать лучшую конфигурацию на основе результатов
5. Применить выбранную конфигурацию в production

---

**Дата создания отчета:** 2025-12-06
**Статус:** Готово к запуску (после исправления путей)














