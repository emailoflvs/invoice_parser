<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Document Analysis</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-file-invoice"></i>
                <h1>Document Analysis</h1>
            </div>
            <p class="subtitle">Invoice and waybill processing and analysis system</p>
        </header>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-card">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h2>Upload Document</h2>
                <p class="upload-description">Supported formats: PDF, JPG, JPEG, PNG, TIFF, BMP</p>
                <p class="upload-warning" id="authWarning" style="display: none; color: #ef4444; margin-top: 10px; font-size: 0.9rem;">
                    <i class="fas fa-lock"></i> Authorization required to upload documents
                </p>

                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.tiff,.bmp" hidden disabled>
                    <div class="upload-content">
                        <i class="fas fa-file-upload"></i>
                        <p>Drag file here or <span class="browse-link">select file</span></p>
                    </div>
                </div>

                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <i class="fas fa-file"></i>
                        <div class="file-name-size">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>
                    </div>
                    <button class="btn-remove" id="removeFile">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="parse-buttons">
                    <button class="btn-primary btn-fast" id="parseFastBtn" disabled>
                        <i class="fas fa-bolt"></i>
                        Quick Analysis
                    </button>
                    <button class="btn-primary btn-detailed" id="parseDetailedBtn" disabled>
                        <i class="fas fa-search"></i>
                        Detailed Analysis
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection" style="display: none;">
            <div class="progress-card">
                <div class="progress-icon">
                    <div class="spinner"></div>
                </div>
                <h3>Processing document...</h3>
                <p class="progress-text">Please wait. Analyzing your document</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-percentage" id="progressPercentage">0%</p>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2>
                    <i class="fas fa-check-circle success-icon"></i>
                    Analysis Results
                </h2>
                <button class="btn-secondary" id="newParseBtn">
                    <i class="fas fa-plus"></i>
                    Upload New Document
                </button>
            </div>

            <!-- Editable Data Section -->
            <div class="result-card editable-section">
                <div class="result-card-header">
                    <i class="fas fa-edit"></i>
                    <h3>Edit Data</h3>
                </div>
                <div class="result-card-body">
                    <div id="editableData">
                        <!-- Динамически заполняется через JS -->
                    </div>
                    <div class="save-section">
                        <button class="btn-secondary btn-save-action" id="backBtn">
                            <i class="fas fa-arrow-left"></i>
                            Back
                        </button>
                        <button class="btn-secondary btn-save-action" id="saveAndContinueBtn">
                            Save and Continue
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Error Section -->
        <div class="error-section" id="errorSection" style="display: none;">
            <div class="error-card">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error</h3>
                <p id="errorMessage"></p>
                <button class="btn-primary" id="retryBtn">
                    <i class="fas fa-redo"></i>
                    Try Again
                </button>
            </div>
        </div>

        <!-- Login Modal (shown on auth error) -->
        <div class="login-modal-overlay" id="loginModal" style="display: none;">
            <div class="login-modal-card">
                <div class="login-modal-header">
                    <div class="login-modal-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2>Authorization Required</h2>
                    <p class="login-modal-subtitle">Please log in to continue</p>
                </div>
                <form id="inlineLoginForm" class="login-modal-form">
                    <div class="login-form-group">
                        <label for="inlineUsername">
                            <i class="fas fa-user"></i>
                            Username
                        </label>
                        <input
                            type="text"
                            id="inlineUsername"
                            name="username"
                            placeholder="Enter username"
                            autocomplete="username"
                            required
                            autofocus
                        >
                    </div>
                    <div class="login-form-group">
                        <label for="inlinePassword">
                            <i class="fas fa-lock"></i>
                            Password
                        </label>
                        <div class="input-with-icon">
                            <input
                                type="password"
                                id="inlinePassword"
                                name="password"
                                placeholder="Enter password"
                                autocomplete="current-password"
                                required
                            >
                            <button type="button" class="toggle-password" id="toggleInlinePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="login-form-message" id="inlineLoginMessage" style="display: none;">
                        <i class="fas" id="inlineLoginMessageIcon"></i>
                        <span id="inlineLoginMessageText"></span>
                    </div>
                    <button type="submit" class="btn-login-modal" id="inlineLoginButton">
                        <i class="fas fa-sign-in-alt"></i>
                        Log In
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Logout Button -->
    <button class="btn-settings" id="logoutBtn" title="Logout">
        <i class="fas fa-sign-out-alt"></i>
    </button>

    <script src="/static/script.js"></script>

    <!-- Auto-reload on file changes (dev mode) -->
    <script>
        // ОТКЛЮЧЕНО: Автоперезагрузка может вызывать проблемы с модальными окнами и постоянными обновлениями
        // Раскомментируйте, если нужно включить автоперезагрузку в dev режиме
        /*
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            let lastModified = null;
            let reloadCheckActive = true;

            setInterval(async () => {
                if (!reloadCheckActive) return;

                try {
                    const response = await fetch('/static/script.js', { method: 'HEAD' });
                    const modified = response.headers.get('Last-Modified');
                    if (lastModified && modified && lastModified !== modified) {
                        console.log('Frontend files updated, reloading...');
                        reloadCheckActive = false; // Предотвращаем множественные перезагрузки
                        window.location.reload(true);
                    }
                    lastModified = modified;
                } catch (e) {
                    // Ignore errors
                }
            }, 5000);
        }
        */
    </script>
</body>
</html>

