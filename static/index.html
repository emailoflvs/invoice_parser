<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Аналіз документів</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-file-invoice"></i>
                <h1>Аналіз документів</h1>
            </div>
            <p class="subtitle">Система обробки та аналізу рахунків і накладних</p>
        </header>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-card">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h2>Завантажте документ</h2>
                <p class="upload-description">Підтримувані формати: PDF, JPG, JPEG, PNG, TIFF, BMP</p>

                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.tiff,.bmp" hidden>
                    <div class="upload-content">
                        <i class="fas fa-file-upload"></i>
                        <p>Перетягніть файл сюди або <span class="browse-link">виберіть файл</span></p>
                    </div>
                </div>

                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <i class="fas fa-file"></i>
                        <div class="file-name-size">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>
                    </div>
                    <button class="btn-remove" id="removeFile">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="parse-buttons">
                    <button class="btn-primary btn-fast" id="parseFastBtn" disabled>
                        <i class="fas fa-bolt"></i>
                        Швидкий аналіз
                    </button>
                    <button class="btn-primary btn-detailed" id="parseDetailedBtn" disabled>
                        <i class="fas fa-search"></i>
                        Детальний аналіз
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection" style="display: none;">
            <div class="progress-card">
                <div class="progress-icon">
                    <div class="spinner"></div>
                </div>
                <h3>Обробка документа...</h3>
                <p class="progress-text">Будь ласка, зачекайте. Триває аналіз вашого документа</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-percentage" id="progressPercentage">0%</p>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2>
                    <i class="fas fa-check-circle success-icon"></i>
                    Результати аналізу
                </h2>
                <button class="btn-secondary" id="newParseBtn">
                    <i class="fas fa-plus"></i>
                    Завантажити новий документ
                </button>
            </div>

            <!-- Editable Data Section -->
            <div class="result-card editable-section">
                <div class="result-card-header">
                    <i class="fas fa-edit"></i>
                    <h3>Редагування даних</h3>
                </div>
                <div class="result-card-body">
                    <div id="editableData">
                        <!-- Динамически заполняется через JS -->
                    </div>
                    <div class="save-section">
                        <button class="btn-secondary btn-save-action" id="backBtn">
                            <i class="fas fa-arrow-left"></i>
                            Назад
                        </button>
                        <button class="btn-secondary btn-save-action" id="saveAndContinueBtn">
                            Зберегти та продовжити
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Error Section -->
        <div class="error-section" id="errorSection" style="display: none;">
            <div class="error-card">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Помилка</h3>
                <p id="errorMessage"></p>
                <button class="btn-primary" id="retryBtn">
                    <i class="fas fa-redo"></i>
                    Спробувати знову
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal (для токена или логина/пароля) -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-cog"></i>
                    Налаштування авторизації
                </h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Переключатель режима -->
                <div class="auth-mode-switcher">
                    <button class="mode-btn active" id="modeTokenBtn" data-mode="token">
                        <i class="fas fa-key"></i>
                        Токен
                    </button>
                    <button class="mode-btn" id="modeLoginBtn" data-mode="login">
                        <i class="fas fa-user"></i>
                        Логін / Пароль
                    </button>
                </div>

                <!-- Режим: Токен -->
                <div class="auth-mode-content" id="tokenMode">
                    <div class="form-group">
                        <label for="authToken">
                            <i class="fas fa-key"></i>
                            Authorization Token
                        </label>
                        <div class="input-with-icon">
                            <input type="password" id="authToken" placeholder="Введіть токен авторизації">
                            <button type="button" class="toggle-password" id="toggleTokenVisibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small>Токен потрібен для доступу до API</small>
                    </div>
                </div>

                <!-- Режим: Логин / Пароль -->
                <div class="auth-mode-content" id="loginMode" style="display: none;">
                    <div class="form-group">
                        <label for="loginUsername">
                            <i class="fas fa-user"></i>
                            Ім'я користувача
                        </label>
                        <input type="text" id="loginUsername" placeholder="Введіть ім'я користувача" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">
                            <i class="fas fa-lock"></i>
                            Пароль
                        </label>
                        <div class="input-with-icon">
                            <input type="password" id="loginPassword" placeholder="Введіть пароль" autocomplete="current-password">
                            <button type="button" class="toggle-password" id="togglePasswordVisibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn-link" id="registerLink" type="button">
                            <i class="fas fa-user-plus"></i>
                            Немає облікового запису? Зареєструватися
                        </button>
                    </div>
                </div>

                <!-- Сообщения об ошибках/успехе -->
                <div class="auth-message" id="authMessage" style="display: none;">
                    <i class="fas" id="authMessageIcon"></i>
                    <span id="authMessageText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelSettings">Скасувати</button>
                <button class="btn-primary" id="saveSettings">Увійти</button>
            </div>
        </div>
    </div>

    <!-- Modal для регистрации -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-user-plus"></i>
                    Реєстрація
                </h3>
                <button class="modal-close" id="closeRegisterModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="registerUsername">
                        <i class="fas fa-user"></i>
                        Ім'я користувача
                    </label>
                    <input type="text" id="registerUsername" placeholder="Введіть ім'я користувача" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="registerEmail">
                        <i class="fas fa-envelope"></i>
                        Email (необов'язково)
                    </label>
                    <input type="email" id="registerEmail" placeholder="Введіть email" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">
                        <i class="fas fa-lock"></i>
                        Пароль
                    </label>
                    <div class="input-with-icon">
                        <input type="password" id="registerPassword" placeholder="Введіть пароль" autocomplete="new-password">
                        <button type="button" class="toggle-password" id="toggleRegisterPasswordVisibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="auth-message" id="registerMessage" style="display: none;">
                    <i class="fas" id="registerMessageIcon"></i>
                    <span id="registerMessageText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelRegister">Скасувати</button>
                <button class="btn-primary" id="saveRegister">Зареєструватися</button>
            </div>
        </div>
    </div>

    <!-- Settings Button -->
    <button class="btn-settings" id="settingsBtn" title="Налаштування">
        <i class="fas fa-cog"></i>
    </button>

    <script src="/static/script.js"></script>

    <!-- Auto-reload on file changes (dev mode) -->
    <script>
        // Check if files are updated every 5 seconds in development
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            let lastModified = null;
            setInterval(async () => {
                try {
                    const response = await fetch('/static/script.js', { method: 'HEAD' });
                    const modified = response.headers.get('Last-Modified');
                    if (lastModified && modified && lastModified !== modified) {
                        console.log('Frontend files updated, reloading...');
                        window.location.reload(true);
                    }
                    lastModified = modified;
                } catch (e) {
                    // Ignore errors
                }
            }, 5000);
        }
    </script>
</body>
</html>

