# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ "–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑" –∏ "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑"

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
1. **–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å (`GEMINI_MODEL_FAST`) –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (`PROMPT_ITEMS_HEADER`) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–ø–æ—Å–æ–± —Å –¥–≤—É–º—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend (Python)

1. **config.py** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
   - `gemini_model_fast` - –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å Gemini
   - `prompt_items_header` - –ø—É—Ç—å –∫ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É

2. **orchestrator.py** - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_fast_parse_with_gemini()`:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–æ–¥–µ–ª—å –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **web_api.py** - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `mode` –≤ endpoint `/parse`:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `mode` –∏–∑ query string (fast/detailed)
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "detailed"
   - –ü–µ—Ä–µ–¥–∞–µ—Ç —Ä–µ–∂–∏–º –≤ orchestrator

### Frontend (HTML/CSS/JS)

4. **index.html** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–µ –∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π:
   - "–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑" (‚ö°)
   - "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑" (üî¨)

5. **script.js** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
   - –§—É–Ω–∫—Ü–∏—è `parseDocument()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `mode`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–≤—É—Ö –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫
   - –ü–∞—Ä–∞–º–µ—Ç—Ä `mode` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ API —á–µ—Ä–µ–∑ query string

6. **style.css** - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫:
   - `.btn-fast` - –æ—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
   - `.btn-detailed` - —Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `.parse-buttons` –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –≤–∞—à–µ–º —Ñ–∞–π–ª–µ `.env` —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```env
GEMINI_MODEL_FAST=gemini-1.5-flash
PROMPT_ITEMS_HEADER=/app/prompts/header+items.txt
```

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

1. **–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:**
   ```bash
   # Backend
   cp config.py /path/to/your/project/invoiceparser/core/config.py
   cp orchestrator.py /path/to/your/project/invoiceparser/services/orchestrator.py
   cp web_api.py /path/to/your/project/invoiceparser/adapters/web_api.py
   
   # Frontend
   cp index.html /path/to/your/project/static/index.html
   cp script.js /path/to/your/project/static/script.js
   cp style.css /path/to/your/project/static/style.css
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞
   ls -la /app/prompts/header+items.txt
   ```
   
   –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ, –æ–±—ä–µ–¥–∏–Ω–∏–≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ header –∏ items –ø—Ä–æ–º–ø—Ç–æ–≤.

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   # –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker
   docker-compose restart
   
   # –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –Ω–∞–ø—Ä—è–º—É—é
   python -m invoiceparser.adapters.main_web
   ```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –î–µ–ª–∞–µ—Ç **2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞** –∫ Gemini:
  1. –ó–∞–ø—Ä–æ—Å —Å `PROMPT_HEADER_PATH` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
  2. –ó–∞–ø—Ä–æ—Å —Å `PROMPT_ITEMS_PATH` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å `GEMINI_MODEL` (gemini-2.5-pro)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `post_processor`
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**, –Ω–æ –¥–æ–ª—å—à–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
- –î–µ–ª–∞–µ—Ç **1 –∑–∞–ø—Ä–æ—Å** –∫ Gemini:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç `PROMPT_ITEMS_HEADER`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å `GEMINI_MODEL_FAST` (gemini-1.5-flash)
- **–ë—ã—Å—Ç—Ä–µ–µ –≤ 2-3 —Ä–∞–∑–∞**, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## UI –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –¥–≤–µ –∫–Ω–æ–ø–∫–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑  ‚îÇ üî¨ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ ‚îÇ
‚îÇ    (–æ—Ä–∞–Ω–∂–µ–≤–∞—è)      ‚îÇ      (—Å–∏–Ω—è—è)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## API –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–π query –ø–∞—Ä–∞–º–µ—Ç—Ä

```bash
# –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
POST /parse?mode=fast

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
POST /parse?mode=detailed
POST /parse  # mode=detailed –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```javascript
// JavaScript
const formData = new FormData();
formData.append('file', fileInput.files[0]);

// –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º
fetch('/parse?mode=fast', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: formData
});

// –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
fetch('/parse?mode=detailed', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: formData
});
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `mode` –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "detailed"
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `mode` –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API endpoints –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–≤–µ –∫–Ω–æ–ø–∫–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–∞ —Ä–µ–∂–∏–º–∞ –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å

## Troubleshooting

### –ö–Ω–æ–ø–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã HTML, JS –∏ CSS –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GEMINI_MODEL_FAST` —É–∫–∞–∑–∞–Ω –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `PROMPT_ITEMS_HEADER` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### –û—à–∏–±–∫–∞ "mode parameter not found"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ web_api.py –æ–±–Ω–æ–≤–ª–µ–Ω
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–µ–π
–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª–∏ –≤ `.env`:
```env
GEMINI_MODEL=gemini-2.5-pro         # –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
GEMINI_MODEL_FAST=gemini-1.5-flash  # –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
–ï—Å–ª–∏ —É –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Ñ–∞–π–ª–∞ `header+items.txt`, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:
```bash
cat /app/prompts/header_v8.txt > /app/prompts/header+items.txt
echo "" >> /app/prompts/header+items.txt
cat /app/prompts/items_v13.txt >> /app/prompts/header+items.txt
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–±–µ –∑–∞–¥–∞—á–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
3. Network tab –≤ DevTools

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-12-08
