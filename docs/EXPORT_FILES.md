# –ì–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

## üìÅ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Web UI (`POST /api/save`) —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

### 1. JSON —Ñ–∞–π–ª (`_saved.json`)

**–ü—É—Ç—å:** `output/{base_name}_saved_{timestamp}.json`

**–ü—Ä–∏–º–µ—Ä:**
```
output/invoice_saved_20251214_1623.json
```

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- –í—Å–µ–≥–¥–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `/api/save`
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 2. Excel —Ñ–∞–π–ª (`.xlsx`)

**–ü—É—Ç—å:** `output/{document_number}.xlsx`

**–ü—Ä–∏–º–µ—Ä:**
```
output/INV-2024-001.xlsx
```

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ `EXPORT_LOCAL_EXCEL_ENABLED=true` –≤ `.env`
- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è APPROVED –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–∂–µ—Ç –Ω–µ —Å–æ–∑–¥–∞—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ —ç–∫—Å–ø–æ—Ä—Ç–∞

## ‚ö†Ô∏è –ü–æ—á–µ–º—É —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –Ω–µ –ø–æ—è–≤–ª—è—Ç—å—Å—è?

### JSON —Ñ–∞–π–ª –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è:

1. **–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs app | grep "save"`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `output/`

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OUTPUT_DIR` –≤ `.env`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### Excel —Ñ–∞–π–ª –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è:

1. **–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç–∫–ª—é—á–µ–Ω:**
   ```env
   EXPORT_LOCAL_EXCEL_ENABLED=false
   ```
   –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `EXPORT_LOCAL_EXCEL_ENABLED=true`

2. **–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs app | grep -i "excel\|export"`
   - –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:
     - –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
     - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π
     - –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

3. **–§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º:**
   - –ò–º—è —Ñ–∞–π–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ `document_number` –∏–ª–∏ `invoice_number`
   - –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
grep EXPORT_LOCAL_EXCEL_ENABLED .env
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `EXPORT_LOCAL_EXCEL_ENABLED=true`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:

```bash
docker-compose logs app | grep -i "excel\|export\|saved"
```

–ò—â–∏—Ç–µ:
- `‚úÖ APPROVED data exported to Excel: ...` - —É—Å–ø–µ—Ö
- `Excel export failed: ...` - –æ—à–∏–±–∫–∞

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã:

```bash
# JSON —Ñ–∞–π–ª—ã
ls -la output/*_saved*.json

# Excel —Ñ–∞–π–ª—ã
ls -la output/*.xlsx
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞:

```bash
docker-compose exec app ls -la /app/output
```

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞: `'str' object has no attribute 'get'`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–∞–Ω–Ω—ã—Ö `references['contract']` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ —Å–ª–æ–≤–∞—Ä—è.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –≤ `excel_formatter.py`.

### –û—à–∏–±–∫–∞: `Excel exporter not initialized`

**–ü—Ä–æ–±–ª–µ–º–∞:** `EXPORT_LOCAL_EXCEL_ENABLED=false` –∏–ª–∏ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `EXPORT_LOCAL_EXCEL_ENABLED=true` –≤ `.env`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose restart app`

### –û—à–∏–±–∫–∞: `Failed to create DocumentItem`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `items`.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ output

```
output/
‚îú‚îÄ‚îÄ invoice_saved_20251214_1623.json  # JSON —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ INV-2024-001.xlsx                 # Excel —Ñ–∞–π–ª (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω)
‚îî‚îÄ‚îÄ ...
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –≤ `excel_formatter.py`:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   ```bash
   docker-compose restart app
   ```

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å–Ω–æ–≤–∞**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs -f app
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:**
   ```bash
   ls -la output/
   ```

## üìù –ò—Ç–æ–≥

- **JSON —Ñ–∞–π–ª** —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- **Excel —Ñ–∞–π–ª** —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
  - `EXPORT_LOCAL_EXCEL_ENABLED=true`
  - –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—à–µ–ª –±–µ–∑ –æ—à–∏–±–æ–∫
  - –î–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Excel —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è!** ‚úÖ

