# JWT_SECRET_KEY - Что это и зачем нужно?

## Что такое JWT_SECRET_KEY?

`JWT_SECRET_KEY` - это секретный ключ, который используется для **подписи и проверки JWT токенов** (JSON Web Tokens).

## Зачем он нужен?

### 1. **Подпись токенов**

Когда пользователь входит в систему, сервер создает JWT токен, который содержит информацию о пользователе (например, username). Этот токен **подписывается** с помощью `JWT_SECRET_KEY`.

```
Токен = Зашифрованные данные пользователя + Подпись (созданная с помощью JWT_SECRET_KEY)
```

### 2. **Проверка подлинности токенов**

Когда пользователь отправляет запрос с токеном, сервер:
1. Извлекает токен из заголовка `Authorization: Bearer <token>`
2. **Проверяет подпись** токена с помощью того же `JWT_SECRET_KEY`
3. Если подпись верна - токен подлинный, пользователь авторизован
4. Если подпись неверна - токен подделан, доступ запрещен

### 3. **Безопасность**

Без правильного `JWT_SECRET_KEY` злоумышленник **не сможет**:
- Создать поддельный токен
- Изменить существующий токен
- Войти в систему от имени другого пользователя

## Где взять JWT_SECRET_KEY?

### Вариант 1: Автоматическая генерация (рекомендуется)

Используйте скрипт для генерации безопасного случайного ключа:

```bash
# В контейнере
docker-compose exec app python scripts/generate_jwt_secret.py

# Или локально
python3 scripts/generate_jwt_secret.py
```

Скрипт сгенерирует случайный ключ длиной 128 символов (64 байта).

### Вариант 2: Генерация через Python

```python
import secrets
print(secrets.token_hex(64))  # 128 символов
```

### Вариант 3: Генерация через OpenSSL

```bash
openssl rand -hex 64
```

### Вариант 4: Онлайн генераторы

Можно использовать онлайн генераторы случайных строк, но **не рекомендуется** для продакшена из-за безопасности.

## Как установить?

### 1. Сгенерируйте ключ

```bash
python3 scripts/generate_jwt_secret.py
```

### 2. Скопируйте сгенерированный ключ

Вывод будет примерно таким:
```
JWT_SECRET_KEY=a1b2c3d4e5f6... (128 символов)
```

### 3. Добавьте в .env файл

Откройте `.env` и добавьте или обновите строку:

```env
JWT_SECRET_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```

### 4. Перезапустите приложение

```bash
docker-compose restart app
```

## Важные правила безопасности

### ✅ ДЕЛАТЬ:

1. **Используйте длинный случайный ключ** (минимум 64 байта = 128 hex символов)
2. **Храните ключ в секрете** - не публикуйте в репозиториях
3. **Используйте разные ключи** для development и production
4. **Регулярно меняйте ключ** в продакшене (раз в год или при компрометации)
5. **Используйте переменные окружения** в продакшене вместо .env файла

### ❌ НЕ ДЕЛАТЬ:

1. **Не используйте простые ключи** типа "secret", "password", "12345"
2. **Не коммитьте ключ** в Git (добавьте .env в .gitignore)
3. **Не используйте один ключ** для всех окружений
4. **Не передавайте ключ** по незащищенным каналам
5. **Не храните ключ** в коде приложения

## Что произойдет, если ключ скомпрометирован?

Если злоумышленник узнал ваш `JWT_SECRET_KEY`, он сможет:
- Создавать поддельные токены для любых пользователей
- Входить в систему от имени любого пользователя
- Получать доступ к защищенным данным

### Что делать:

1. **Немедленно измените ключ** в `.env`
2. **Перезапустите приложение** - все существующие токены станут недействительными
3. **Все пользователи должны перелогиниться** - их старые токены перестанут работать
4. **Проверьте логи** на подозрительную активность

## Примеры

### Правильный ключ (хорошо):
```
JWT_SECRET_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```
- Длинный (128+ символов)
- Случайный
- Не содержит словарных слов

### Неправильный ключ (плохо):
```
JWT_SECRET_KEY=secret
JWT_SECRET_KEY=password123
JWT_SECRET_KEY=my-secret-key
```
- Слишком короткий
- Предсказуемый
- Легко угадать

## Проверка текущего ключа

Чтобы проверить, установлен ли ключ:

```bash
# В контейнере
docker-compose exec app python -c "
import sys
sys.path.insert(0, 'src')
from invoiceparser.core.config import Config
config = Config.load()
if config.jwt_secret_key == 'your-secret-key-change-in-production':
    print('⚠️  WARNING: Using default JWT_SECRET_KEY! Change it immediately!')
else:
    print('✅ JWT_SECRET_KEY is set')
    print(f'   Length: {len(config.jwt_secret_key)} characters')
"
```

## Резюме

- **JWT_SECRET_KEY** - секретный ключ для подписи токенов
- **Генерируйте** случайный ключ длиной минимум 64 байта
- **Храните в секрете** - не коммитьте в Git
- **Используйте разные ключи** для dev/prod
- **Меняйте регулярно** в продакшене

Сгенерировать ключ: `python3 scripts/generate_jwt_secret.py`










